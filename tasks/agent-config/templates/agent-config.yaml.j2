# Generated by Ansible
apiVersion: v1beta1
kind: AgentConfig
metadata:
  name: {{ (single_node | bool) | ternary('sno', 'ha') }}
rendezvousIP: {{ rendezvous_ip }}

{% set masters_ = masters | default([]) %}
{%- set workers_ = workers | default([]) -%}
{%- set infras_  = infras  | default([]) -%}
{%- set all_hosts = masters_ + workers_ + infras_ -%}

hosts:
{%- for h in all_hosts -%}
  {% set nic_name       = h.nic_name       | default(defaults.nic_name) %}
  {% set root_device    = h.root_device    | default(defaults.root_device) %}
  {% set prefix_length  = h.prefix_length  | default(defaults.prefix_length) %}
  {% set dhcp_enabled   = h.dhcp           | default(defaults.dhcp) %}
  {% set gateway        = h.gateway        | default(defaults.gateway) %}
  {% set dns_servers    = h.dns_servers    | default(defaults.dns_servers) %}
  {% set nic_type       = h.nic_type       | default(defaults.nic_type) %}
  {% set nic_state      = h.nic_state      | default(defaults.nic_state) %}
  {% set route_dest     = h.route_destination | default(defaults.route_destination) %}
  {% set route_table_id = h.route_table_id | default(defaults.route_table_id) %}

  - hostname: {{ h.name }}.{{ cluster_domain }}.{{ base_domain }}
    interfaces:
      - name: {{ nic_name }}
        macAddress: {{ h.mac }}
    rootDeviceHints:
      deviceName: {{ root_device }}
    networkConfig:
      interfaces:
        - name: {{ nic_name }}
          type: {{ nic_type }}
          state: {{ nic_state }}
          mac-address: {{ h.mac }}
          ipv4:
            enabled: true
{% if not dhcp_enabled %}
            address:
              - ip: {{ h.ip }}
                prefix-length: {{ prefix_length }}
{% endif %}
            dhcp: {{ dhcp_enabled | lower }}
      dns-resolver:
        config:
          server:
{% for s in dns_servers %}
            - {{ s }}
{% endfor %}
      routes:
        config:
          - destination: {{ route_dest }}
            next-hop-address: {{ gateway }}
            next-hop-interface: {{ nic_name }}
            table-id: {{ route_table_id }}
{% endfor %}
